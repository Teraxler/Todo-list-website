import{hideOverlay as e,showOverlay as o}from"./shared.js";import{convertImgToCanvas as t,formattingDateTime as d,getDateTimeV2 as l,idGenerator as i}from"./utils.js";let todoPriority=null,selectedTodo=null;function resetTodoForm(){document.getElementById("todo-form").reset()}function showTodoModal(){o(),document.getElementById("todo-modal").classList.remove("opacity-0","invisible")}function hideTodoModal(){e(),hideTodoCoverPreview(),showTodoUploadLabel(),document.getElementById("todo-modal")?.classList.add("opacity-0","invisible")}function prepareCreateTodoModal(){document.getElementById("todo-form__update-todo-btn").classList.add("hidden"),document.getElementById("todo-modal__edit-todo-title").classList.add("hidden"),document.getElementById("todo-modal__new-todo-title").classList.remove("hidden"),document.getElementById("todo-form__create-todo-btn").classList.remove("hidden")}function showCreateTodoModal(){resetTodoForm(),document.getElementById("todo-form__date").value=d(l()).dateTimeISO,prepareCreateTodoModal(),showTodoModal()}function preFillFromInputs(e){let{id:o,title:t,description:d,priority:l,cover:i,createdAt:r}=e;document.getElementById("todo-form__title").value=t,document.getElementById("todo-form__date").value=r,document.getElementById("todo-form__description").value=d,document.getElementById(`priority-${l.toLowerCase()}`).checked=!0,document.getElementById("todo-form__update-todo-btn").dataset.taskId=o;let a=document.getElementById("todo-form__cover").previousElementSibling.children[0];a.src=i.img?i.img:`/Todo-list-website/public/assets/images/todoes/${i.path}`,showTodoCoverPreview(),hideTodoUploadLabel()}function prepareEditTodoModal(e){resetTodoForm(),preFillFromInputs(e),document.getElementById("todo-form__create-todo-btn").classList.add("hidden"),document.getElementById("todo-modal__new-todo-title").classList.add("hidden"),document.getElementById("todo-form__update-todo-btn").classList.remove("hidden"),document.getElementById("todo-modal__edit-todo-title").classList.remove("hidden")}function showEditTodoModal(e){selectedTodo=e,prepareEditTodoModal(e),showTodoModal()}function showTodoUploadLabel(){document.getElementById("todo-form__cover-upload-label")?.classList.remove("hidden")}function hideTodoUploadLabel(){document.getElementById("todo-form__cover-upload-label").classList.add("hidden")}function showTodoCoverPreviewHandler(e){let o=new FileReader,d=e.target.files[0],l=e.target.previousElementSibling;d&&(o.onload=e=>{l.children[0].src=e.target.result;let o=new Image;o.onload=()=>{t(o)},o.src=e.target.result},o.readAsDataURL(d)),showTodoCoverPreview(),hideTodoUploadLabel()}function showTodoCoverPreview(){let e=document.getElementById("todo-form__cover-preview");e.classList.remove("hidden")}function hideTodoCoverPreview(){document.getElementById("todo-form__cover-preview")?.classList.add("hidden")}function generateNewTodo(e,o){return{id:e??i(),status:"Not Started",priority:document.querySelector(".priority-task:checked")?.dataset.taskPriority,cover:o??{path:"./default-todo-cover.png",alt:"default todo cover",type:"png",img:null},title:document.getElementById("todo-form__title").value.trim(),createdAt:document.getElementById("todo-form__date").value,description:document.getElementById("todo-form__description").value.trim()}}function createTodoHandler(e){e.preventDefault();let o=document.getElementById("todo-form__cover").files,d=generateNewTodo();if(isTodoValid(d)){if(o.length){let l=new FileReader;l.onload=e=>{let o=new Image;o.onload=()=>{d.cover.img=t(o),d.cover.alt=d.title,document.dispatchEvent(new CustomEvent("todoCreated",{detail:d}))},o.src=e.target.result},l.readAsDataURL(o[0])}else document.dispatchEvent(new CustomEvent("todoCreated",{detail:d}));hideTodoModal()}}function updateEditedTodo(e){let o=document.getElementById("todo-form__cover").files,d=generateNewTodo(e,selectedTodo.cover);if(isTodoValid(d)){if(o.length){let l=new FileReader;l.onload=e=>{let l=new Image;l.onload=()=>{d.cover.img=t(l),d.cover.alt=d.title,d.cover.type=o[0].type,document.dispatchEvent(new CustomEvent("todoUpdated",{detail:d}))},l.src=e.target.result},l.readAsDataURL(o[0])}else document.dispatchEvent(new CustomEvent("todoUpdated",{detail:d}));hideTodoModal()}}function updateTodoHandler(e){e.preventDefault();let o=e.currentTarget.dataset.taskId;updateEditedTodo(o)}let updateTodoBtn=document.getElementById("todo-form__update-todo-btn");function isTodoValid({title:e,description:o,file:t,createdAt:d,priority:l}){e=e.trim(),o=o.trim();let i=e&&o&&d&&l,r=["image/png","image/jpg","image/jpeg","image/webp"].includes(t?.type),a=["high","medium","low"].includes(l),n=t?.size<=5e5;return null==i?(swal({title:"Please fill all fields",icon:"warning"}),!1):t&&null==n?(swal({title:"Cover must be maximum 500KB",icon:"warning"}),!1):t&&null==r?(swal({title:"Cover type must be one of (png, jpg, jpeg, webp)",icon:"warning"}),!1):null!=a||(swal({title:"Priority must be (High, Medium or low)",icon:"warning"}),!1)}function deSelectPriorityInputs(){[...document.getElementsByClassName("priority-task")].forEach(e=>e.checked=!1)}function selectTodoPriorityHandler(e){let o=e.target;"INPUT"===o.tagName&&o.checked?(deSelectPriorityInputs(),o.checked=!0,todoPriority=o.dataset.taskPriority):todoPriority=null}updateTodoBtn?.addEventListener("click",updateTodoHandler);let priorityTasksContainer=document.getElementById("todo-form__priority-container");priorityTasksContainer?.addEventListener("click",selectTodoPriorityHandler);let createTodoBtn=document.getElementById("todo-form__create-todo-btn");createTodoBtn?.addEventListener("click",createTodoHandler);let todoCoverInput=document.getElementById("todo-form__cover");todoCoverInput?.addEventListener("change",showTodoCoverPreviewHandler);let closeCreateTodoModalBtn=document.getElementById("todo-modal__close-btn");closeCreateTodoModalBtn?.addEventListener("click",hideTodoModal);export{showCreateTodoModal,showEditTodoModal,hideTodoModal};