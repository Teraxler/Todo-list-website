import{hideOverlay as e,showOverlay as t}from"./shared.js";import{convertImgToCanvas as o,formattingDateTime as n,getDateTimeV2 as r,idGenerator as l}from"./utils.js";let s=null,i=null;function a(){document.getElementById("todo-form").reset()}function c(){t();document.getElementById("todo-modal").classList.remove("opacity-0","invisible")}function d(){e();g();y();document.getElementById("todo-modal")?.classList.add("opacity-0","invisible")}function u(){document.getElementById("todo-form__update-todo-btn").classList.add("hidden");document.getElementById("todo-modal__edit-todo-title").classList.add("hidden");document.getElementById("todo-modal__new-todo-title").classList.remove("hidden");document.getElementById("todo-form__create-todo-btn").classList.remove("hidden")}function m(){a();document.getElementById("todo-form__date").value=n(r()).dateTimeISO;u();c()}function f(e){const{id:t,title:o,description:n,priority:r,cover:l,createdAt:s}=e;document.getElementById("todo-form__title").value=o;document.getElementById("todo-form__date").value=s;document.getElementById("todo-form__description").value=n;document.getElementById(`priority-${r.toLowerCase()}`).checked=!0;document.getElementById("todo-form__update-todo-btn").dataset.taskId=t;const a=document.getElementById("todo-form__cover").previousElementSibling.children[0];a.src=l.img?l.img:`/public/assets/images/todoes/${l.path}`;p();h()}function v(e){a();f(e);document.getElementById("todo-form__create-todo-btn").classList.add("hidden");document.getElementById("todo-modal__new-todo-title").classList.add("hidden");document.getElementById("todo-form__update-todo-btn").classList.remove("hidden");document.getElementById("todo-modal__edit-todo-title").classList.remove("hidden")}function E(e){i=e;v(e);c()}function y(){document.getElementById("todo-form__cover-upload-label")?.classList.remove("hidden")}function h(){document.getElementById("todo-form__cover-upload-label").classList.add("hidden")}function I(e){const t=new FileReader,n=e.target.files[0],r=e.target.previousElementSibling;n&&(t.onload=e=>{r.children[0].src=e.target.result;const t=new Image;t.onload=()=>{o(t)};t.src=e.target.result},t.readAsDataURL(n));p();h()}function p(){document.getElementById("todo-form__cover-preview").classList.remove("hidden")}function g(){document.getElementById("todo-form__cover-preview")?.classList.add("hidden")}function L(e,t){return{id:e??l(),status:"not started",priority:document.querySelector(".priority-task:checked")?.dataset.taskPriority,cover:t??{path:"./default-todo-cover.png",alt:"default todo cover",type:"png",img:null},title:document.getElementById("todo-form__title").value.trim(),createdAt:document.getElementById("todo-form__date").value,description:document.getElementById("todo-form__description").value.trim()}}function T(e){e.preventDefault();const t=document.getElementById("todo-form__cover").files,n=L();if(b(n)){if(t.length){const e=new FileReader;e.onload=e=>{const t=new Image;t.onload=()=>{n.cover.img=o(t);n.cover.alt=n.title;document.dispatchEvent(new CustomEvent("todoCreated",{detail:n}))};t.src=e.target.result},e.readAsDataURL(t[0])}else document.dispatchEvent(new CustomEvent("todoCreated",{detail:n}));d()}}function _(e){const t=document.getElementById("todo-form__cover").files,n=L(e,i.cover);if(b(n)){if(t.length){const e=new FileReader;e.onload=e=>{const r=new Image;r.onload=()=>{n.cover.img=o(r);n.cover.alt=n.title;n.cover.type=t[0].type;document.dispatchEvent(new CustomEvent("todoUpdated",{detail:n}))};r.src=e.target.result},e.readAsDataURL(t[0])}else document.dispatchEvent(new CustomEvent("todoUpdated",{detail:n}));d()}}function C(e){e.preventDefault();const t=e.currentTarget.dataset.taskId;_(t)}function b({title:e,description:t,file:o,createdAt:n,priority:r}){const l=["image/png","image/jpg","image/jpeg","image/webp"],s=["high","medium","low"];e=e.trim();t=t.trim();const i=e&&t&&n&&r,a=l.includes(o?.type),c=s.includes(r),d=o?.size<=5e5;if(null==i){swal({title:"Please fill all fields",icon:"warning"});return!1}if(o&&null==d){swal({title:"Cover must be maximum 500KB",icon:"warning"});return!1}if(o&&null==a){swal({title:"Cover type must be one of (png, jpg, jpeg, webp)",icon:"warning"});return!1}if(null==c){swal({title:"Priority must be (High, Medium or low)",icon:"warning"});return!1}return!0}function k(){[...document.getElementsByClassName("priority-task")].forEach(e=>e.checked=!1)}function w(e){const t=e.target;"INPUT"===t.tagName&&t.checked?(k(),t.checked=!0,s=t.dataset.taskPriority):s=null}const O=document.getElementById("todo-form__update-todo-btn");O?.addEventListener("click",C);const A=document.getElementById("todo-form__priority-container");A?.addEventListener("click",w);const S=document.getElementById("todo-form__create-todo-btn");S?.addEventListener("click",T);const x=document.getElementById("todo-form__cover");x?.addEventListener("change",I);const N=document.getElementById("todo-modal__close-btn");N?.addEventListener("click",d);export{m as showCreateTodoModal,E as showEditTodoModal,d as hideTodoModal};