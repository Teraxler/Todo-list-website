import{deleteCookie,findUser,getCookie,getDateTime,getFromLocalStorage,insertTextContent,searchTodo}from"./modules/utils.js";import{hideCalendar,showCalendar}from"./modules/calendar.js";import{hideNotifications,showNotifications}from"./modules/notification.js";import{hideOverlay,hideTodoOptions,hideTransparentOverlay,showOverlay,showTransparentOverlay}from"./modules/shared.js";import{hideTodoModal}from"./modules/todo-modal.js";let DB={},user={},isSidebarVisible=window.innerWidth>=600;function showSidebar(){hideVisibleContent();const e=document.getElementById("sidebar");e.classList.remove("-left-50"),e.classList.add("left-0"),showTransparentOverlay()}function hideSidebar(){const e=document.getElementById("sidebar");e.classList.add("-left-50"),e.classList.remove("left-0"),hideTransparentOverlay()}function toggleMenu(){isSidebarVisible?hideSidebar():showSidebar(),isSidebarVisible=!isSidebarVisible}const toggleSidebarBtn=document.getElementById("toggle-menu");function showSearchBar(){hideVisibleContent(),showOverlay();document.getElementById("mobile-search-bar").classList.remove("hidden")}function hideSearchBar(){hideOverlay();document.getElementById("mobile-search-bar").classList.add("hidden")}function hideVisibleContent(){hideSidebar(),hideSearchBar(),hideNotifications(),hideCalendar(),hideTodoModal(),hideTodoOptions()}toggleSidebarBtn.addEventListener("click",toggleMenu);const overlay=document.getElementById("overlay");overlay.addEventListener("click",hideVisibleContent);const searchBarIcon=document.getElementById("search-bar-icon");searchBarIcon.addEventListener("click",showSearchBar);const searchResultContainer=document.getElementById("search-result-container"),mobileSearchResultContainer=document.getElementById("mobile-search-result");function insertSearchResult(e,t){if(null==t)return;let n="";e.length?e.forEach((e=>{const{id:t,priority:s,cover:i,title:a}=e;n+=`\n      <li class="px-3.75 py-1.5 lg:py-2.5">\n        <a\n          class="flex items-center justify-between gap-x-4 cursor-pointer"\n          href="/Todo-list-website/public/pages/todo-details.html?id=${t}"\n        >\n          <div>\n            <p class="text-sm lg:text-base/relaxed line-clamp-2">${a}</p>\n            <span class="font-medium text-xs">Priority: </span\n            ><span class="font-medium text-xs ${"high"===s.toLowerCase()?"text-danger":"medium"===s.toLowerCase()?"text-amber-400":"text-picton-blue"}">${s}</span>\n          </div>\n          <div\n            class="size-10 lg:size-13 shrink-0 rounded-sm overflow-hidden">\n          ${i.img?`<img class="aspect-square" src="${i.img}" alt="${i.alt}"/>`:`<img class="aspect-square" src="//Todo-list-website/public/assets/images/todoes/${i.path}" alt="${i.alt}"/>`}\n          </div>\n        </a>\n      </li>\n      `})):n='<li class="px-3.75 py-1.5 lg:py-2.5"> <span class="text-quick-silver">Try something different</span></li>',t.innerHTML=n}function insertSearchResultHandler(e){const t=e.target.value.trim();if(t.length>2){const e=getFromLocalStorage("DB").users,n=getCookie("userId");user=findUser(n,e);const s=searchTodo(t,user.todos);insertSearchResult(s,searchResultContainer),insertSearchResult(s,mobileSearchResultContainer)}else{const e='\n      <li class="px-3.75 py-1.5 lg:py-2.5">\n        <span class="text-quick-silver">You must type at least 3 characters</span>\n      </li>';searchResultContainer.innerHTML=e,mobileSearchResultContainer.innerHTML=e}}const headerSearchInput=document.getElementById("header-search-input");headerSearchInput.addEventListener("keyup",insertSearchResultHandler);const mobileSearchInput=document.getElementById("mobile-search-input");function insertDate(){const e=document.getElementById("today-date"),t=getDateTime();e.innerHTML=`<span>${t.weekdayName}</span>\n          <span class="text-picton-blue">${t.date}</span>`}function routeProtection(){null==getCookie("userId")&&(location.href="//Todo-list-website/public/pages/login.html")}mobileSearchInput.addEventListener("keyup",insertSearchResultHandler),window.addEventListener("load",(async()=>{routeProtection(),insertDate();const e=getCookie("userId");DB=getFromLocalStorage("DB"),user=findUser(e,DB.users),insertTextContent(`${user.name} ${user.family}`,"user-full-name"),insertTextContent(user.email,"user-email")})),document.getElementById("notification-show-btn").addEventListener("click",(()=>{hideVisibleContent(),showNotifications()})),document.getElementById("notification__hide-btn").addEventListener("click",hideNotifications),document.getElementById("calendar-show-btn").addEventListener("click",(()=>{hideVisibleContent(),showCalendar()})),document.getElementById("transparent-overlay").addEventListener("click",hideVisibleContent);const logoutBtn=document.getElementsByClassName("logout-btn")[0];logoutBtn.addEventListener("click",(async e=>{e.preventDefault();await swal({title:"Are you sure want to logout?",icon:"warning",buttons:{no:{text:"Cancel",value:!1,className:"swal-btn--natural"},yes:{text:"Yes, logout!",value:!0,className:"swal-btn--danger"}}})&&(deleteCookie("userId","/src"),location.href="//Todo-list-website/public/pages/login.html")}));