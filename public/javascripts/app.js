import{deleteCookie as e,findUser as t,formattingDateTime as i,getCookie as s,getDateTime as n,getFromLocalStorage as l,insertTextContent as a,searchTodo as r}from"./modules/utils.js";import{hideCalendar as o,showCalendar as d}from"./modules/calendar.js";import{hideNotifications as c,showNotifications as u}from"./modules/notification.js";import{hideOverlay as m,hideTodoOptions as h,hideTransparentOverlay as b,showOverlay as g,showTransparentOverlay as p}from"./modules/shared.js";import{hideTodoModal as y}from"./modules/todo-modal.js";let user={},isSidebarVisible=!1;function showSidebar(){hideVisibleContent();let e=document.getElementById("sidebar");e.classList.replace("-left-50","left-0"),p(),isSidebarVisible=!0}function hideSidebar(){let e=document.getElementById("sidebar");e.classList.replace("left-0","-left-50"),b(),isSidebarVisible=!1}function toggleSidebar(){isSidebarVisible?hideSidebar():showSidebar()}let toggleSidebarBtn=document.getElementById("toggle-menu");function showSearchBarMobile(){hideVisibleContent(),g(),document.getElementById("mobile-search-bar").classList.remove("hidden")}function hideSearchBarMobile(){m(),document.getElementById("mobile-search-bar").classList.add("hidden")}function hideVisibleContent(){hideSidebar(),hideSearchBarMobile(),c(),o(),y(),h()}toggleSidebarBtn.addEventListener("click",toggleSidebar);let overlay=document.getElementById("overlay");overlay.addEventListener("click",hideVisibleContent);let searchBarIcon=document.getElementById("search-bar-icon");searchBarIcon.addEventListener("click",showSearchBarMobile);let searchResultContainer=document.getElementById("search-result-container"),mobileSearchResultContainer=document.getElementById("mobile-search-result");function insertSearchResult(e,t){if(null==t)return;let i="";e.length?e.forEach(e=>{let{id:t,priority:s,cover:n,title:l}=e;i+=`<li class="px-3.75 py-1.5 lg:py-2.5"><a class="flex items-center justify-between gap-x-4 cursor-pointer" href="/public/pages/todo-details.html?id=${t}"><div><p class="text-sm lg:text-base/relaxed line-clamp-2">${l}</p><span class="font-medium text-xs">Priority: </span><span class="font-medium text-xs ${"high"===s.toLowerCase()?"text-danger":"medium"===s.toLowerCase()?"text-amber-400":"text-picton-blue"}">${s}</span></div><div class="size-10 lg:size-13 shrink-0 rounded-sm overflow-hidden">${n.img?`<img class="aspect-square" src="${n.img}" alt="${n.alt}" />`:`<img class="aspect-square" src="/public/assets/images/todoes/${n.path}" alt="${n.alt}" />`}</div></a></li>`}):i='<li class="px-3.75 py-1.5 lg:py-2.5"> <span class="text-quick-silver">Try something different</span></li>',t.innerHTML=i}function getUser(){let e=l("DB").users,i=s("userId");return t(i,e)}function insertSearchResultHandler(e){let t=e.target.value.trim();if(t.length>2){user=getUser();let i=r(t,user.todos);insertSearchResult(i,searchResultContainer),insertSearchResult(i,mobileSearchResultContainer)}else{let s=`<li class="px-3.75 py-1.5 lg:py-2.5"><span class="text-quick-silver">You must type at least 3 characters</span></li>`;searchResultContainer.innerHTML=s,mobileSearchResultContainer.innerHTML=s}}let headerSearchInput=document.getElementById("header-search-input");headerSearchInput.addEventListener("keyup",insertSearchResultHandler);let mobileSearchInput=document.getElementById("mobile-search-input");function insertDate(){let e=document.getElementById("today-date"),t=n();t=i(t),e.innerHTML=`<span>${t.weekdayName}</span><span class="text-picton-blue">${t.date}</span>`}function routeProtection(){let e=s("userId");null==e&&(location.href="/public/pages/login.html")}function initilize(){insertDate(),user=getUser(),a(`${user.name} ${user.family}`,"user-full-name"),a(user.email,"user-email")}mobileSearchInput.addEventListener("keyup",insertSearchResultHandler),window.addEventListener("load",async()=>{routeProtection(),initilize()}),document.getElementById("notification-show-btn").addEventListener("click",()=>{hideVisibleContent(),u()}),document.getElementById("notification__hide-btn").addEventListener("click",c),document.getElementById("calendar-show-btn").addEventListener("click",()=>{hideVisibleContent(),d()}),document.getElementById("transparent-overlay").addEventListener("click",hideVisibleContent);let logoutBtn=document.getElementsByClassName("logout-btn")[0];logoutBtn.addEventListener("click",async t=>{t.preventDefault();let i=await swal({title:"Are you sure want to logout?",icon:"warning",buttons:{no:{text:"Cancel",value:!1,className:"swal-btn--natural"},yes:{text:"Yes, logout!",value:!0,className:"swal-btn--danger"}}});i&&(e("userId","/public"),routeProtection())});