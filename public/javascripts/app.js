import{findUser as e,getDateTime as t,getFromLocalStorage as s,insertTextContent as n,removeFromLocalStorage as a,searchTodo as i}from"./modules/utils.js";import{hideCalendar as l,showCalendar as r}from"./modules/calendar.js";import{hideNotifications as o,showNotifications as d}from"./modules/notification.js";import{hideOverlay as c,hideTodoOptions as u,hideTransparentOverlay as m,showOverlay as h,showTransparentOverlay as g}from"./modules/shared.js";import{hideTodoModal as p}from"./modules/todo-modal.js";let DB={},user={},isSidebarVisible=window.innerWidth>=600;function showSidebar(){hideVisibleContent();let e=document.getElementById("sidebar");e.classList.remove("-left-47"),e.classList.add("left-0"),g()}function hideSidebar(){let e=document.getElementById("sidebar");e.classList.add("-left-47"),e.classList.remove("left-0"),m()}function toggleMenu(){isSidebarVisible?hideSidebar():showSidebar(),isSidebarVisible=!isSidebarVisible}let toggleSidebarBtn=document.getElementById("toggle-menu");function showSearchBar(){hideVisibleContent(),h();let e=document.getElementById("mobile-search-bar");e.classList.remove("hidden")}function hideSearchBar(){c();let e=document.getElementById("mobile-search-bar");e.classList.add("hidden")}function hideVisibleContent(){hideSidebar(),hideSearchBar(),o(),l(),p(),u()}toggleSidebarBtn.addEventListener("click",toggleMenu);let overlay=document.getElementById("overlay");overlay.addEventListener("click",hideVisibleContent);let searchBarIcon=document.getElementById("search-bar-icon");searchBarIcon.addEventListener("click",showSearchBar);let searchResultContainer=document.getElementById("search-result-container"),mobileSearchResultContainer=document.getElementById("mobile-search-result");function insertSearchResult(e,t){if(!t)return;let s="";e.length?e.forEach(e=>{let{id:t,priority:n,cover:a,title:i}=e;s+=`
      <li class="px-3.75 py-1.5 lg:py-2.5">
        <a
          class="flex items-center justify-between gap-x-4 cursor-pointer"
          href="../../public/pages/todo-details.html?id=${t}"
        >
          <div>
            <p class="text-sm lg:text-base/relaxed line-clamp-2">${i}</p>
            <span class="font-medium text-xs">Priority: </span
            ><span class="font-medium text-xs ${"high"===n.toLowerCase()?"text-danger":"medium"===n.toLowerCase()?"text-amber-400":"text-picton-blue"}">${n}</span>
          </div>
          <div
            class="size-10 lg:size-13 shrink-0 rounded-sm overflow-hidden">
          ${a.img?`<img class="aspect-square" src="${a.img}" alt="${a.alt}" />`:`<img class="aspect-square" src="../../public/assets/images/todoes/${a.path}" alt="${a.alt}" />`}
          </div>
        </a>
      </li>
      `}):s='<li class="px-3.75 py-1.5 lg:py-2.5"> <span class="text-quick-silver">Try something different</span></li>',t.innerHTML=s}function insertSearchResultHandler(t){let n=t.target.value.trim();if(n.length>2){let a=s("DB").users,l=s("currentUser").userId;user=e(l,a);let r=i(n,user.todos);insertSearchResult(r,searchResultContainer),insertSearchResult(r,mobileSearchResultContainer)}else{let o=`
      <li class="px-3.75 py-1.5 lg:py-2.5">
        <span class="text-quick-silver">You must type at least 3 characters</span>
      </li>`;searchResultContainer.innerHTML=o,mobileSearchResultContainer.innerHTML=o}}let headerSearchInput=document.getElementById("header-search-input");headerSearchInput.addEventListener("keyup",insertSearchResultHandler);let mobileSearchInput=document.getElementById("mobile-search-input");function insertDate(){let e=document.getElementById("today-date"),s=t();e.innerHTML=`<span>${s.weekdayName}</span>
          <span class="text-picton-blue">${s.date}</span>`}function routeProtection(){let e=s("currentUser");e||(location.href="./pages/login.html")}mobileSearchInput.addEventListener("keyup",insertSearchResultHandler),window.addEventListener("load",async()=>{routeProtection(),insertDate();let t=s("currentUser");DB=s("DB"),user=e(t.userId,DB.users),n(`${user.name} ${user.family}`,"user-full-name"),n(user.email,"user-email")}),document.getElementById("notification-show-btn").addEventListener("click",()=>{hideVisibleContent(),d()}),document.getElementById("notification__hide-btn").addEventListener("click",o),document.getElementById("calendar-show-btn").addEventListener("click",()=>{hideVisibleContent(),r()}),document.getElementById("transparent-overlay").addEventListener("click",hideVisibleContent);let logoutBtn=document.getElementsByClassName("logout-btn")[0];logoutBtn.addEventListener("click",async e=>{e.preventDefault();let t=await swal({title:"Are you sure want to logout?",icon:"warning",buttons:{no:{text:"Cancel",value:!1,className:"swal-btn--natural"},yes:{text:"Yes, logout!",value:!0,className:"swal-btn--danger"}}});t&&(a("currentUser"),location.href="./pages/login.html")});