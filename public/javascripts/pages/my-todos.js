import{showLoader as e,hideLoader as t,getPriorityColorClass as s,getStatusColorClass as o,updateUserTodos as d,updateUsers as l,deleteUserTodo as n,getDB as r,updateDB as i}from"../modules/shared.js";import{findTodo as a,findUser as c,formattingDateTime as u,getCookie as p,getFromLocalStorage as m,insertTextContent as x,normalizeDateTime as T}from"../modules/utils.js";import{showEditTodoModal as g}from"../modules/todo-modal.js";let user={},DB={},selectedTodoId=null;function generateTodo(e){let{id:t,title:d,status:l,priority:n,createdAt:r,description:i,cover:a}=e,c=s(n),p=o(l),m=T(r);return`<!-- Task --><div class="min-h-33.5 relative py-2 pl-5 sm:pl-3 md:pl-8 xl:pl-10 pr-3 md:pr-4.5 border border-quick-silver rounded-[14px] cursor-pointer${t===selectedTodoId?"bg-quick-silver/17":""}" onclick="showTodoDetailsHandler('${t}')"><!-- Circle Shape--><span class="sm:hidden md:inline-block absolute top-2.5 xl:top-3.5 left-2 xl:left-3.5 size-2 md:size-2.5 xl:size-3 border-${p} border-2 rounded-full"></span><div class="flex justify-between gap-x-2 xl:gap-x-2.5"><div><p class="text-sm xl:text-base font-semibold line-clamp-1">${d}</p><p class="text-xs xl:text-sm/[17px] line-clamp-2 mt-5">${i}</p></div><div class="my-auto size-18 lg:size-22 shrink-0 mt-3.25"><img class="h-full aspect-square rounded-xl lg:rounded-[14px] overflow-hidden" ${a.img?`src=${a.img}`:`src="../assets/images/todoes/${a.path}"`} alt="${a.alt}"/></div></div><div class="flex justify-between gap-x-0.5 text-[10px] mt-1.5"><span>Priority:<span class="capitalize block text-nowrap xl:inline text-${c}">${n}</span></span><span>Status:<span class="capitalize block text-nowrap xl:inline text-${p}">${l}</span></span><span class="text-quick-silver">Created on:<span class="block text-nowrap xl:inline">${u(m).date}</span></span></div></div>`}function insertTodos(e){let t="",s=null,o=document.getElementById("todos-container");e.length?e.forEach(e=>{s&&s!==e.createdAt.slice(0,10)&&(t+=`<!-- Line --><div class="w-[calc(100%+24px)] lg:w-[calc(100%+36px)] 2xl:w-[calc(100%+60px)] -ml-3 lg:-ml-4.5 2xl:-ml-7.5 my-3 lg:my-6 border-t border-quick-silver/41"></div>`),s=e.createdAt.slice(0,10),t+=generateTodo(e)}):t="<span class='block text-center text-davy-grey py-20 sm:py-5'>No Todo created yet</span>",o.innerHTML=t}function insertSelectedTodoPriority(e){let t=document.getElementById("todo-priority"),o="text-"+s(e);t.classList.remove("text-danger","text-amber-400","text-picton-blue"),t.textContent=e,t.classList.add(o)}function insertSelectedTodoStatus(e){let t=document.getElementById("todo-status"),s="text-"+o(e);t.classList.remove("text-danger","text-blue-bonnet","text-success"),t.textContent=e,t.classList.add(s)}function insertTodoCover(e){let t=document.getElementById("todo-cover");t.alt=e.alt,t.src=e.img?e.img:`../assets/images/todoes/${e.path}`}function insertTodoDetails(e){if(e){insertTodoCover(e.cover),insertSelectedTodoStatus(e.status),insertSelectedTodoPriority(e.priority);let t=T(e.createdAt),s=u(t).date;x(e.title,"todo-title"),x(s,"todo-created-at"),x(e.description,"todo-description")}else document.getElementById("todo-details-container").innerHTML=`<span class="block text-center text-davy-grey py-20">Please select a todo</span>`}function initialize(){DB=m("DB");let e=p("userId");selectedTodoId=(user=c(e,DB.users)).todos[0]?.id,render()}function render(){insertTodos(user.todos),insertTodoDetails(user.todos[0])}async function deleteTodoHandler(){let e=await swal({title:"Delete Todo",text:"Are you sure to delete todo?",icon:"warning",buttons:{no:{text:"Cancel",value:!1,className:"swal-btn--natural"},yes:{text:"Delete",value:!0,className:"swal-btn--danger"}}});e&&(user=n(selectedTodoId,user),DB.users=l(user,DB.users),i(DB),0===user.todos.length&&(location.href="../index.html"),initialize())}function editTodoHandler(){let e=a(selectedTodoId,user.todos);g(e)}function startTodoHandler(){let e=a(selectedTodoId,user.todos);e.status="in progress",user=d(e,user),DB.users=l(user,DB.users),i(DB),insertTodos(user.todos),insertSelectedTodoStatus("in progress")}function completeTodoHandler(){let e=a(selectedTodoId,user.todos);e.status="completed",user=d(e,user),DB.users=l(user,DB.users),i(DB),insertTodos(user.todos),insertSelectedTodoStatus("completed")}window.addEventListener("load",()=>{e(),initialize(),t()});let deleteTodoBtn=document.getElementById("delete-todo-btn"),editTodoBtn=document.getElementById("edit-todo-btn"),startTodoBtn=document.getElementById("start-todo-btn"),completeTodoBtn=document.getElementById("complete-todo-btn");function updateTodoHandler(s){e(),user=d(s.detail,user),DB.users=l(user,DB.users),i(DB),insertTodos(user.todos),insertTodoDetails(s.detail),t()}function showTodoDetailsHandler(e){selectedTodoId=e;let t=r("DB"),s=p("userId");user=c(s,t.users),insertTodos(user.todos);let o=a(e,user.todos);insertTodoDetails(o)}deleteTodoBtn.addEventListener("click",deleteTodoHandler),editTodoBtn.addEventListener("click",editTodoHandler),startTodoBtn.addEventListener("click",startTodoHandler),completeTodoBtn.addEventListener("click",completeTodoHandler),document.addEventListener("todoUpdated",updateTodoHandler),window.showTodoDetailsHandler=showTodoDetailsHandler;