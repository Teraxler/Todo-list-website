import{showLoader as a,hideLoader as b,getPriorityColorClass as c,getStatusColorClass as d}from"../modules/shared.js";import{findTodo as e,findTodoIndex as f,findUser as g,getCookie as h,getFromLocalStorage as i,insertTextContent as j,normalizeDateTime as k,saveToLocalStorage as l}from"../modules/utils.js";import{showEditTodoModal as m}from"../modules/todo-modal.js";let n={},o=null;function p(q){const{id:r,title:s,status:t,priority:u,createdAt:v,description:w,cover:x}=q,y=c(u),z=d(t);return`<div class="min-h-33.5 relative py-2 pl-5 sm:pl-3 md:pl-8 xl:pl-10 pr-3 md:pr-4.5 border border-quick-silver rounded-[14px] cursor-pointer ${r===o?"bg-quick-silver/17":""}" onclick="showTodoDetailsHandler('${r}')"><span class="sm:hidden md:inline-block absolute top-2.5 xl:top-3.5 left-2 xl:left-3.5 size-2 md:size-2.5 xl:size-3 border-${z} border-2 rounded-full"></span><div class="flex justify-between gap-x-2 xl:gap-x-2.5"><div><p class="text-sm xl:text-base font-semibold line-clamp-1">${s}</p><p class="text-xs xl:text-sm/[17px] line-clamp-2 mt-5">${w}</p></div><div class="my-auto size-18 lg:size-22 shrink-0 mt-3.25"><img class="h-full aspect-square rounded-xl lg:rounded-[14px] overflow-hidden" ${x.img?`src=${x.img}`:`src="../assets/images/todoes/${x.path}"`} alt=""/></div></div><div class="flex justify-between gap-x-0.5 text-[10px] mt-1.5"><span>Priority: <span class="capitalize block text-nowrap xl:inline text-${y}">${u}</span></span><span>Status: <span class="capitalize block text-nowrap xl:inline text-${z}">${t}</span></span><span class="text-quick-silver">Created on: <span class="block text-nowrap xl:inline">${k(v).date}</span></span></div></div>`}function A(B){let C="",D=null;const E=document.getElementById("todos-container");B.length?(B.forEach(F=>{D&&D!==F.createdAt.slice(0,10)&&(C+=`<div class="w-[calc(100%+24px)] lg:w-[calc(100%+36px)] 2xl:w-[calc(100%+60px)] -ml-3 lg:-ml-4.5 2xl:-ml-7.5 my-3 lg:my-6 border-t border-quick-silver/41"></div>`),D=F.createdAt.slice(0,10),C+=p(F)})):C=`<span class='block text-center text-davy-grey py-20 sm:py-5'>No Todo created yet</span>`,E.innerHTML=C}function G(H){const I=document.getElementById("todo-priority"),J={high:"text-danger",medium:"text-amber-400",low:"text-picton-blue"};I.classList.remove("text-danger","text-amber-400","text-picton-blue"),I.textContent=H,I.classList.add(J[H.toLowerCase()])}function K(L){const M=document.getElementById("todo-status"),N={"not started":"text-danger","in progress":"text-blue-bonnet",completed:"text-success"};M.classList.remove("text-danger","text-blue-bonnet","text-success"),M.textContent=L,M.classList.add(N[L.toLowerCase()])}function O(P){if(!P)return void(document.getElementById("todo-details-container").innerHTML=`<span class="block text-center text-davy-grey py-20">Please select a todo</span>`);const Q=document.getElementById("todo-cover");Q.src=P.cover.img?P.cover.img:`../assets/images/todoes/${P.cover.path}`,K(P.status),G(P.priority),j(P.title,"todo-title"),j(P.description,"todo-description"),j(P.title,"todo-title");const R=k(P.createdAt).date;j(R,"todo-created-at")}window.addEventListener("load",()=>{a();const S=i("DB"),T=h("userId");n=g(T,S.users),o=n.todos[0]?.id,A(n.todos),O(n.todos[0]),b()});function U(V){let W,X,Y;const Z=V.length;if(W=X=Y=0,Z){V.forEach(aa=>{switch(aa.status){case"not started":W++;break;case"in progress":X++;break;case"completed":Y++;break}}),n.statistics={completed:Math.round(Y/Z*100),"in progress":Math.round(X/Z*100),"not started":Math.round(W/Z*100)}}else n.statistics={completed:0,"in progress":0,"not started":0}}async function ab(){const ac=await swal({title:"Delete Todo",text:"Are you sure to delete todo?",icon:"warning",buttons:{no:{text:"Cancel",value:!1,className:"swal-btn--natural"},yes:{text:"Delete",value:!0,className:"swal-btn--danger"}}});ac&&(n.todos=n.todos.filter(ad=>ad.id!==o),ae(n),0===n.todos.length?location.href="../index.html":null,o=n.todos[0].id,A(n.todos),O(n.todos[0]))}function af(){const ag=e(o,n.todos);m(ag)}function ah(){const ai=f(o,n.todos);ai!==-1&&(n.todos[ai].status="in progress",A(n.todos),K("in progress"),U(n.todos),ae(n))}function aj(){const ak=f(o,n.todos);ak!==-1&&(n.todos[ak].status="completed",A(n.todos),K("completed"),U(n.todos),ae(n))}const al=document.getElementById("delete-todo-btn"),am=document.getElementById("edit-todo-btn"),an=document.getElementById("start-todo-btn"),ao=document.getElementById("complete-todo-btn");al.addEventListener("click",ab),am.addEventListener("click",af),an.addEventListener("click",ah),ao.addEventListener("click",aj);function ap(aq,ar){aq=[...aq];const as=aq.findIndex(at=>String(at.id)===String(ar.id));return aq[as]=ar,aq}function ae(au){const av=i("DB"),aw=av.users.findIndex(ax=>ax.id===au.id);aw!==-1&&(av.users[aw]=au,l("DB",av))}function ay(az){a();const aA=az.detail;n.todos=ap(n.todos,aA),U(n.todos),ae(n),A(n.todos),O(aA),b()}document.addEventListener("todoUpdated",ay),window.showTodoDetailsHandler=aB;function aB(aC){o=aC;const aD=i("DB"),aE=h("userId");n=g(aE,aD.users),A(n.todos);const aF=e(aC,n.todos);O(aF)}