import{showLoader,hideLoader,getPriorityColorClass,getStatusColorClass}from"../modules/shared.js";import{findTodo,findTodoIndex,findUser,getCookie,getFromLocalStorage,insertTextContent,normalizeDateTime,saveToLocalStorage}from"../modules/utils.js";import{showEditTodoModal}from"../modules/todo-modal.js";let user={},selectedTodoId=null;function generateTodo(e){const{id:t,title:o,status:s,priority:d,createdAt:n,description:r,cover:a}=e,i=getPriorityColorClass(d),l=getStatusColorClass(s);return`\x3c!-- Task --\x3e\n              <div\n                class="min-h-33.5 relative py-2 pl-5 sm:pl-3 md:pl-8 xl:pl-10 pr-3 md:pr-4.5 border border-quick-silver rounded-[14px] cursor-pointer\n                  ${t===selectedTodoId?"bg-quick-silver/17":""}"\n                  onclick="showTodoDetailsHandler('${t}')">\n                \x3c!-- Circle Shape--\x3e\n                <span\n                  class="sm:hidden md:inline-block absolute top-2.5 xl:top-3.5 left-2 xl:left-3.5 size-2 md:size-2.5 xl:size-3 border-${l} border-2 rounded-full"\n                ></span>\n                <div class="flex justify-between gap-x-2 xl:gap-x-2.5">\n                  <div>\n                    <p class="text-sm xl:text-base font-semibold line-clamp-1">\n                      ${o}\n                    </p>\n                    <p class="text-xs xl:text-sm/[17px] line-clamp-2 mt-5">\n                      ${r}\n                    </p>\n                  </div>\n                  <div class="my-auto size-18 lg:size-22 shrink-0 mt-3.25">\n                    <img\n                      class="h-full aspect-square rounded-xl lg:rounded-[14px] overflow-hidden"\n                      ${a.img?`src=${a.img}`:`src="../assets/images/todoes/${a.path}"`}\n\n                      alt=""\n                    />\n                  </div>\n                </div>\n\n                <div class="flex justify-between gap-x-0.5 text-[10px] mt-1.5">\n                  <span>\n                    Priority:\n                    <span class="capitalize block text-nowrap xl:inline text-${i}"\n                      >${d}</span\n                    >\n                  </span>\n                  <span>\n                    Status:\n                    <span class="capitalize block text-nowrap xl:inline text-${l}"\n                      >${s}</span\n                    >\n                  </span>\n                  <span class="text-quick-silver">\n                    Created on:\n                    <span class="block text-nowrap xl:inline">${normalizeDateTime(n).date}</span>\n                  </span>\n                </div>\n              </div>`}function insertTodos(e){let t="",o=null;const s=document.getElementById("todos-container");e.length?e.forEach((e=>{o&&o!==e.createdAt.slice(0,10)&&(t+='\x3c!-- Line --\x3e\n                <div\n                class="w-[calc(100%+24px)] lg:w-[calc(100%+36px)] 2xl:w-[calc(100%+60px)] -ml-3 lg:-ml-4.5 2xl:-ml-7.5 my-3 lg:my-6 border-t border-quick-silver/41"\n                ></div>'),o=e.createdAt.slice(0,10),t+=generateTodo(e)})):t="<span class='block text-center text-davy-grey py-20 sm:py-5'>No Todo created yet</span>",s.innerHTML=t}function insertSelectedTodoPriority(e){const t=document.getElementById("todo-priority");t.classList.remove("text-danger","text-amber-400","text-picton-blue"),t.textContent=e,t.classList.add({high:"text-danger",medium:"text-amber-400",low:"text-picton-blue"}[e.toLowerCase()])}function insertSelectedTodoStatus(e){const t=document.getElementById("todo-status");t.classList.remove("text-danger","text-blue-bonnet","text-success"),t.textContent=e,t.classList.add({"not started":"text-danger","in progress":"text-blue-bonnet",completed:"text-success"}[e.toLowerCase()])}function insertTodoDetails(e){if(!e)return void(document.getElementById("todo-details-container").innerHTML='\n      <span class="block text-center text-davy-grey py-20">Please select a todo</span>\n    ');document.getElementById("todo-cover").src=e.cover.img?e.cover.img:`../assets/images/todoes/${e.cover.path}`,insertSelectedTodoStatus(e.status),insertSelectedTodoPriority(e.priority),insertTextContent(e.title,"todo-title"),insertTextContent(e.description,"todo-description"),insertTextContent(e.title,"todo-title");const t=normalizeDateTime(e.createdAt).date;insertTextContent(t,"todo-created-at")}function updateStatistics(e){let t,o,s;const d=e.length;t=o=s=0,d?(e.forEach((e=>{switch(e.status){case"not started":t++;break;case"in progress":o++;break;case"completed":s++}})),user.statistics={completed:Math.round(s/d*100),"in progress":Math.round(o/d*100),"not started":Math.round(t/d*100)}):user.statistics={completed:0,"in progress":0,"not started":0}}async function deleteTodoHandler(){await swal({title:"Delete Todo",text:"Are you sure to delete todo?",icon:"warning",buttons:{no:{text:"Cancel",value:!1,className:"swal-btn--natural"},yes:{text:"Delete",value:!0,className:"swal-btn--danger"}}})&&(user.todos=user.todos.filter((e=>e.id!==selectedTodoId)),updateDB(user),0===user.todos.length&&(location.href="../index.html"),selectedTodoId=user.todos[0].id,insertTodos(user.todos),insertTodoDetails(user.todos[0]))}function editTodoHandler(){const e=findTodo(selectedTodoId,user.todos);showEditTodoModal(e)}function startTodoHandler(){const e=findTodoIndex(selectedTodoId,user.todos);-1!==e&&(user.todos[e].status="in progress",insertTodos(user.todos),insertSelectedTodoStatus("in progress"),updateStatistics(user.todos),updateDB(user))}function completeTodoHandler(){const e=findTodoIndex(selectedTodoId,user.todos);-1!==e&&(user.todos[e].status="completed",insertTodos(user.todos),insertSelectedTodoStatus("completed"),updateStatistics(user.todos),updateDB(user))}window.addEventListener("load",(()=>{showLoader();const e=getFromLocalStorage("DB"),t=getCookie("userId");user=findUser(t,e.users),selectedTodoId=user.todos[0]?.id,insertTodos(user.todos),insertTodoDetails(user.todos[0]),hideLoader()}));const deleteTodoBtn=document.getElementById("delete-todo-btn"),editTodoBtn=document.getElementById("edit-todo-btn"),startTodoBtn=document.getElementById("start-todo-btn"),completeTodoBtn=document.getElementById("complete-todo-btn");function updateTodos(e,t){const o=(e=[...e]).findIndex((e=>String(e.id)===String(t.id)));return e[o]=t,e}function updateDB(e){const t=getFromLocalStorage("DB"),o=t.users.findIndex((t=>t.id===e.id));-1!==o&&(t.users[o]=e,saveToLocalStorage("DB",t))}function updateTodoHandler(e){showLoader();const t=e.detail;user.todos=updateTodos(user.todos,t),updateStatistics(user.todos),updateDB(user),insertTodos(user.todos),insertTodoDetails(t),hideLoader()}function showTodoDetailsHandler(e){selectedTodoId=e;const t=getFromLocalStorage("DB"),o=getCookie("userId");user=findUser(o,t.users),insertTodos(user.todos);insertTodoDetails(findTodo(e,user.todos))}deleteTodoBtn.addEventListener("click",deleteTodoHandler),editTodoBtn.addEventListener("click",editTodoHandler),startTodoBtn.addEventListener("click",startTodoHandler),completeTodoBtn.addEventListener("click",completeTodoHandler),document.addEventListener("todoUpdated",updateTodoHandler),window.showTodoDetailsHandler=showTodoDetailsHandler;