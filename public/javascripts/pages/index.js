import{calcRelativeDateTimeDifference as a,clacDegreesOfPercent as b,convertMonthToMonthName as c,filterCompletedTodos as d,filterNotCompletedTodos as e,findTodoIndex as f,findUser as g,getCookie as h,getFromLocalStorage as i,insertTextContent as j,normalizeDateTime as k,saveToLocalStorage as l}from"../modules/utils.js";import{showCreateTodoModal as m,showEditTodoModal as n}from"../modules/todo-modal.js";import{getPriorityColorClass as o,getStatusColorClass as p,hideLoader as q,hideTodoOptions as r,showLoader as s,showTodoOptions as t}from"../modules/shared.js";let u={},v={};function w(x){const{id:y,title:z,description:A,cover:B,createdAt:C,priority:D,status:E}=x,F=o(D),G=p(E);return`<div class="max-w-100 relative py-3.5 pl-8 xl:pl-10 pr-7 xl:pr-7.5 outline outline-quick-silver rounded-[14px]"><div class="absolute top-3 xl:top-3.5 left-3 xl:left-3.5 size-2.5 xl:size-3 border-2 border-${G} rounded-full"></div><div class="task-options absolute top-2.5 right-3 xl:right-3.5"><div class="task-options__icon flex gap-x-0.5 cursor-pointer py-1"><span class="size-1 border border-quick-silver rounded-full"></span><span class="size-1 border border-quick-silver rounded-full"></span><span class="size-1 border border-quick-silver rounded-full"></span></div><div class="task-options__list invisible opacity-0 absolute z-10 right-0 bg-white flex flex-col gap-y-1.25 mt-0.5 px-1.25 pb-1.75 pt-2.25 leading-5 rounded-lg shadow" data-is-visible="false"><button class="task-options__edit-task text-xs text-start cursor-pointer" onclick="startTaskHandler('${y}')">Start</button><button class="task-options__edit-task text-xs text-start cursor-pointer" onclick="editTaskHandler('${y}')">Edit</button><button class="task-options__delete-task text-xs text-start cursor-pointer" onclick="deleteTaskHandler('${y}')">Delete</button><button class="task-options__finish-task text-xs text-start cursor-pointer" onclick="finishTaskHandler('${y}')">Finish</button></div></div><div class="flex justify-between gap-x-2 xl:gap-x-2.5"><div><p class="text-sm xl:text-base/[19px] font-semibold"><a class="line-clamp-2" href="./pages/todo-details.html?id=${y}">${z}</a></p><p class="text-xs xl:text-sm/[17px] line-clamp-4 mt-2 xl:mt-2.5">${A}</p></div><div class="my-auto size-20 lg:size-22 shrink-0"><a href="./pages/todo-details.html?id=${y}"><img class="aspect-square h-full rounded-xl lg:rounded-[14px] overflow-hidden" ${B.img?`src="${B.img}"`:`src="./assets/images/todoes/${B.path}"`} alt="${B.alt}"></a></div></div><div class="flex justify-between gap-x-0.5 text-[10px] mt-3 xl:mt-3.5"><span>Priority: <span class="capitalize block xl:inline text-${F}">${D}</span></span><span>Status: <span class="capitalize block xl:inline text-${G}">${E}</span></span><span class="text-quick-silver">Created on: <span class="block xl:inline">${k(C).date}</span></span></div></div>`}function H(I){const J=document.getElementById("todo-date"),K=document.getElementById("todo-time-difference"),L=k(I),M=c(L.months);J.innerHTML=`${L.days} ${M}`,K.innerHTML=`â€¢ ${a(I)}`}function N(O){const P=document.getElementById("todos-container");O=e(O);let Q="",R=null;O.length?(H(O[0].createdAt),O.forEach(S=>{S.status.toLowerCase()!=="completed"&&(R&&R!==S.createdAt.slice(0,10)&&(Q+=`<div class="w-[calc(100%+24px)] lg:w-[calc(100%+56px)] 2xl:w-[calc(100%+68px)] -ml-3 lg:-ml-7 2xl:-ml-8.5 my-3 lg:my-6 border-t border-quick-silver/41"></div>`),R=S.createdAt.slice(0,10),Q+=w(S))})):Q="<span class='text-center text-davy-grey py-5'>No Todo created yet</span>",P.innerHTML=Q}function T(U){let V="";const W=document.getElementById("todos-stats-container");for(const X in U){const Y=p(X);V+=`<div><div class="donut-chart shrink-0" style="background: conic-gradient(var(--color-${Y}) 0deg ${b(U[X])}deg, var(--color-light-silver) ${b(U[X])}deg 360deg);"><span class="donut-chart__title">${U[X]}%</span></div><li class="capitalize block mt-5 text-xs lg:text-sm xl:text-base text-center dot-icon dot-icon--${Y}">${X}</li></div>`}W.innerHTML=V}function Z(aa){let ab="";aa=d(aa);const ac=document.getElementById("todos-completed-container");aa.length&&aa.forEach(ad=>{ab+=w(ad)}),ab||(ab="<span class='text-center text-davy-grey py-5'>Nothing Completed yet</span>"),ac.innerHTML=ab}function ae(){[...document.getElementsByClassName("task-options__icon")].forEach(af=>af.addEventListener("click",t))}window.addEventListener("load",async()=>{s();const ag=h("userId");u=i("DB"),v=g(ag,u.users),j(`Welcome ${v.name} ðŸ‘‹`,"user-name"),T(v.statistics),Z(v.todos),N(v.todos),ae(),q()});function ah(ai){const aj=u.users.findIndex(ak=>String(ak.id)===String(ai.id));u.users[aj]=ai,l("DB",u),u=i("DB"),v=u.users[aj]}function al(am){let an,ao,ap;const aq=am.length;if(an=ao=ap=0,aq){am.forEach(ar=>{switch(ar.status){case"not started":an++;break;case"in progress":ao++;break;case"completed":ap++;break}}),v.statistics={completed:Math.round(ap/aq*100),"in progress":Math.round(ao/aq*100),"not started":Math.round(an/aq*100)}}else v.statistics={completed:0,"in progress":0,"not started":0};ah(v)}window.startTaskHandler=as;function as(at){r();const au=f(at,v.todos);au!==-1&&(v.todos[au].status="in progress",ah(v),N(v.todos),Z(v.todos),al(v.todos),T(v.statistics),ae())}window.editTaskHandler=av;function av(aw){r();const ax=f(aw,v.todos);ax!==-1?n(v.todos[ax]):null}window.deleteTaskHandler=ay;async function ay(az){r();const aA=await swal({title:"Delete Todo",text:"are you sure want to delete todo?",icon:"warning",buttons:["Cancel","Delete"]});if(aA){const aB=v.todos.filter(aC=>String(aC.id)!==String(az));v.todos=[...aB],ah(v),N(v.todos),Z(v.todos),al(v.todos),T(v.statistics),ae()}}window.finishTaskHandler=aD;function aD(aE){r();const aF=f(aE,v.todos);aF!==-1&&(v.todos[aF].status="completed",ah(v),N(v.todos),Z(v.todos),al(v.todos),T(v.statistics),ae())}const aG=document.getElementById("show-create-todo-modal");aG.addEventListener("click",m);function aH(aI){s();let aJ=[...v.todos];v.todos.length=0,v.todos=[aI.detail,...aJ],ah(v),N(v.todos),al(v.todos),T(v.statistics),ae(),q()}function aK(aL){s();const aM=aL.detail,aN=f(aM.id,v.todos);aN!==-1&&(v.todos[aN]=aM,ah(v),N(v.todos),Z(v.todos),al(v.todos),T(v.statistics),ae()),q()}document.addEventListener("todoCreated",aH),document.addEventListener("todoUpdated",aK);