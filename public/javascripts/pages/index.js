import{calcRelativeDateTimeDifference as e,clacDegreesOfPercent as t,filterCompletedTodos as s,filterNotCompletedTodos as o,findUser as i,normalizeDateTime as n,formattingDateTime as l,getCookie as r,insertTextContent as a,findTodo as d,calcStatistics as c}from"../modules/utils.js";import{showCreateTodoModal as u,showEditTodoModal as p}from"../modules/todo-modal.js";import{deleteUserTodo as x,getDB as m,getPriorityColorClass as g,getStatusColorClass as h,hideLoader as v,hideTodoOptions as f,showLoader as b,showTodoOptions as T,updateDB as $,updateUsers as k,updateUserTodos as y}from"../modules/shared.js";let DB={},user={};function generateTodo(e){let{id:t,title:s,description:o,cover:i,createdAt:r,priority:a,status:d}=e,c=g(a),u=h(d),p=n(r);return`<div class="max-w-100 relative py-3.5 pl-8 xl:pl-10 pr-7 xl:pr-7.5 outline outline-quick-silver rounded-[14px]"><!-- Circle Shape--><div class="absolute top-3 xl:top-3.5 left-3 xl:left-3.5 size-2.5 xl:size-3 border-2 border-${u} rounded-full"></div><!-- Menu Icon --><div class="task-options absolute top-2.5 right-3 xl:right-3.5"><div class="task-options__icon flex gap-x-0.5 cursor-pointer py-1" onclick="showTodoOptions(this)"><span class="size-1 border border-quick-silver rounded-full"></span><span class="size-1 border border-quick-silver rounded-full"></span><span class="size-1 border border-quick-silver rounded-full"></span></div><!-- Drop-Down --><div class="task-options__list invisible opacity-0 absolute z-10 right-0 bg-white flex flex-col gap-y-0.75 mt-0.5 px-1.25 pb-1.75 pt-2.25 leading-5 rounded-lg shadow" data-is-visible="false"><button class="task-options__edit-task text-xs text-start cursor-pointer transition-colors hover:bg-ghost-white rounded-sm p-0.5" onclick="startTodoHandler('${t}')">Start</button><button class="task-options__edit-task text-xs text-start cursor-pointer transition-colors hover:bg-ghost-white rounded-sm p-0.5" onclick="editTodoHandler('${t}')">Edit</button><button class="task-options__delete-task text-xs text-start cursor-pointer transition-colors hover:bg-ghost-white rounded-sm p-0.5" onclick="deleteTodoHandler('${t}')">Delete</button><button class="task-options__finish-task text-xs text-start cursor-pointer transition-colors hover:bg-ghost-white rounded-sm p-0.5" onclick="finishTodoHandler('${t}')">Finish</button></div></div><div class="flex justify-between gap-x-2 xl:gap-x-2.5"><div><p class="text-sm xl:text-base/[19px] font-semibold"><a class="line-clamp-1" title="${s}" href="./pages/todo-details.html?id=${t}">${s}</a></p><p class="text-xs xl:text-sm/[17px] line-clamp-2 mt-2 xl:mt-2.5" title="${o}">${o}</p></div><div class="my-auto size-20 lg:size-22 shrink-0"><a href="./pages/todo-details.html?id=${t}"><img class="aspect-square h-full rounded-xl lg:rounded-[14px] overflow-hidden" ${i.img?`src="${i.img}"`:`src="./assets/images/todoes/${i.path}"`} alt="${i.alt}"></a></div></div><div class="flex justify-between gap-x-0.5 text-[10px] mt-3 xl:mt-3.5"><span>Priority:<span class="capitalize block xl:inline text-${c}">${a}</span></span><span>Status:<span class="capitalize block xl:inline text-${u}">${d}</span></span><span class="text-quick-silver">Created on:<span class="block xl:inline">${l(p).date}</span></span></div></div>`}function insertNewestTodoDate(t){let s=document.getElementById("todo-date"),o=document.getElementById("todo-time-difference"),i=n(t),r=l(i).monthName;s.textContent=`${i.day} ${r}`,o.textContent=`â€¢ ${e(t)}`,setInterval(()=>{o.textContent=`â€¢ ${e(t)}`},6e4)}function insertTodos(e){let t=document.getElementById("todos-container");e=o(e);let s="",i=null;e.length?(insertNewestTodoDate(e[0].createdAt),e.forEach(e=>{i&&i!==e.createdAt.slice(0,10)&&(s+='<div class="w-[calc(100%+24px)] lg:w-[calc(100%+56px)] 2xl:w-[calc(100%+68px)] -ml-3 lg:-ml-7 2xl:-ml-8.5 my-3 lg:my-6 border-t border-quick-silver/41"></div>'),i=e.createdAt.slice(0,10),s+=generateTodo(e)})):s="<span class='text-center text-davy-grey py-5'>No Todo created yet</span>",t.innerHTML=s}function generateDonutChart(e,s){let o=h(e);return`<div><div class="donut-chart shrink-0" style="background: conic-gradient(var(--color-${o}) 0deg ${t(s)}deg, var(--color-light-silver) ${t(s)}deg 360deg);"><span class="donut-chart__title">${s}%</span></div><li class="capitalize block mt-5 text-xs lg:text-sm xl:text-base text-center dot-icon dot-icon--${o}">${e}</li></div>`}function insertTodosStatistics(e){let t="",s=document.getElementById("todos-stats-container");for(let o in e)t+=generateDonutChart(o,e[o]);s.innerHTML=t}function insertCompletedTodos(e){let t="";e=s(e);let o=document.getElementById("todos-completed-container");e.length&&e.forEach(e=>{t+=generateTodo(e)}),t||(t="<span class='text-center text-davy-grey py-5'>Nothing Completed yet</span>"),o.innerHTML=t}function render(){a(`Welcome ${user.name} ðŸ‘‹`,"user-name"),insertTodosStatistics(user.statistics),insertCompletedTodos(user.todos),insertTodos(user.todos)}function initialize(){DB=m();let e=r("userId");user=i(e,DB.users),render()}function startTodoHandler(e){f();let t=d(e,user.todos);t.status="in progress",user=y(t,user),DB.users=k(user,DB.users),$(DB),initialize()}function editTodoHandler(e){f();let t=d(e,user.todos);t&&p(t)}async function deleteTodoHandler(e){f();let t=await swal({title:"Delete Todo",text:"are you sure want to delete todo?",icon:"warning",buttons:["Cancel","Delete"]});t&&(user=x(e,user),DB.users=k(user,DB.users),$(DB),initialize())}function finishTodoHandler(e){f();let t=d(e,user.todos);t.status="completed",user=y(t,user),DB.users=k(user,DB.users),$(DB),initialize()}window.showTodoOptions=T,window.addEventListener("load",async()=>{b(),initialize(),v()}),window.startTodoHandler=startTodoHandler,window.editTodoHandler=editTodoHandler,window.deleteTodoHandler=deleteTodoHandler,window.finishTodoHandler=finishTodoHandler;let showCreateTodoModalBtn=document.getElementById("show-create-todo-modal");function saveTodoHandler(e){b(),user.todos.unshift(e.detail),user.statistics=c(user.todos),DB.users=k(user,DB.users),$(DB),initialize(),v()}function updateTodoHandler(e){b(),user=y(e.detail,user),DB.users=k(user,DB.users),$(DB),initialize(),v()}showCreateTodoModalBtn.addEventListener("click",u),document.addEventListener("todoCreated",saveTodoHandler),document.addEventListener("todoUpdated",updateTodoHandler);