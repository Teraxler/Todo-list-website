import{hideLoader as e,showLoader as t}from"../modules/shared.js";import{findUser as a,getFromLocalStorage as n,saveToLocalStorage as s}from"../modules/utils.js";let user={};function fillUserInfo(e){let t=document.getElementById("first-name-input"),a=document.getElementById("last-name-input"),n=document.getElementById("email-input");document.getElementById("current-password-input"),document.getElementById("new-password-input"),t.value=e.name,a.value=e.family,n.value=e.email}function isPasswordCorrect(e){let t=user.password===e;return t||swal({title:"Your password is wrong",icon:"error"}),t}function isUserValid({name:e,family:t,email:a,newPassword:n}){console.log("\uD83D\uDE80 ~ isUserValid ~ newPassword:",n),console.log("\uD83D\uDE80 ~ isUserValid ~ email:",a),console.log("\uD83D\uDE80 ~ isUserValid ~ family:",t),console.log("\uD83D\uDE80 ~ isUserValid ~ name:",e);let s={name:/^[a-zA-Z]{3,16}$/,email:/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,password:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)*(?=.*[@\(!\)%*?&])[a-zA-Z\d@\(!\)%*?&]{8,24}$/};return n?e&&t&&a&&n?s.name.test(e)?s.name.test(t)?s.email.test(a)?!!s.password.test(n)||(swal({title:"please enter valid password",text:"at least 8 charactor, contain lower case, upper case, number, special charactor",icon:"warning"}),!1):(swal({title:"Please enter valid email",icon:"warning"}),!1):(swal({title:"Please enter valid last name",text:"minimun 3 charactor (number is not valid!!)",icon:"warning"}),!1):(swal({title:"Please enter valid first name",text:"minimun 3 charactor (number is not valid!!)",icon:"warning"}),!1):(swal({title:"Please fill all fields",icon:"warning"}),!1):(swal({title:"Please enter new password",text:"if you don't want to change password enter current password",icon:"warning"}),!1)}function getUpdatedUser(){let e=document.getElementById("new-password-input"),t=document.getElementById("first-name-input"),a=document.getElementById("last-name-input"),n=document.getElementById("email-input"),s=document.getElementById("current-password-input");return{...user,name:t.value.trim(),family:a.value.trim(),email:n.value.trim(),password:s.value.trim(),newPassword:e.value.trim()}}function updateDB(e){let t=n("DB"),a=t.users.findIndex(t=>t.id===e.id);-1!==a&&(t.users[a]=e,s("DB",t))}function updateUserHandler(e){e.preventDefault();let t=getUpdatedUser();isPasswordCorrect(t.password)&&isUserValid(t)&&(t.password=t.newPassword,delete t.newPassword,updateDB(user=t),swal({title:"Your information successfuly updated",icon:"success"}).then(()=>location.reload()))}let saveChangesBtn=document.getElementById("save-changes-btn");saveChangesBtn.addEventListener("click",updateUserHandler),window.addEventListener("load",()=>{t();let s=n("currentUser").userId,r=n("DB");user=a(s,r.users),fillUserInfo(user),e()});