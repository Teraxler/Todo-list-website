import{findTodo as t,findUser as e,formattingDateTime as o,getCookie as d,getQueryParam as s,normalizeDateTime as n}from"../modules/utils.js";import{showEditTodoModal as r}from"../modules/todo-modal.js";import{deleteUserTodo as i,getDB as l,getPriorityColorClass as a,getStatusColorClass as u,hideLoader as c,showLoader as m,updateDB as B,updateUsers as T,updateUserTodos as p}from"../modules/shared.js";let user={},DB={};function initialize(){DB=l();let o=d("userId");user=e(o,DB.users);let n=s("id");n||(location.href="../index.html");let r=t(n,user.todos);r||(location.href="../index.html"),insertTodoContent(r)}function insertTodoPriority(t){let e=document.getElementById("todo-priority"),o="text-"+a(t);e.classList.remove("text-danger","text-amber-400","text-picton-blue"),e.textContent=t,e.classList.add(o)}function insertTodoStatus(t){let e=document.getElementById("todo-status"),o="text-"+u(t);e.classList.remove("text-danger","text-blue-bonnet","text-success"),e.textContent=t,e.classList.add(o)}function insertTodoContent(t){let e=document.getElementById("todo-description"),d=document.getElementById("todo-title"),s=document.getElementById("todo-cover"),r=document.getElementById("todo-created-at");e.textContent=t.description,d.textContent=t.title,s.src=t.cover.img?t.cover.img:`../assets/images/todoes/${t.cover.path}`,insertTodoPriority(t.priority),insertTodoStatus(t.status);let i=n(t.createdAt);r.textContent=o(i).date}window.addEventListener("load",async()=>{m(),initialize(),c()});let deleteTodoBtn=document.getElementById("delete-todo-btn"),editTodoBtn=document.getElementById("edit-todo-btn"),startTodoBtn=document.getElementById("start-todo-btn"),completeTodoBtn=document.getElementById("complete-todo-btn");async function deleteTodoHandler(){let t=await swal({title:"Delete Todo",text:"Are you sure to delete todo?",icon:"warning",buttons:{no:{text:"Cancel",value:!1,className:"swal-btn--natural"},yes:{text:"Delete",value:!0,className:"swal-btn--danger"}}});if(t){let e=s("id");user=i(e,user),DB.users=T(user,DB.users),B(DB),location.href="../index.html"}}function editTodoHandler(){let e=s("id"),o=t(e,user.todos);r(o)}function startTodoHandler(){let e=s("id"),o=t(e,user.todos);o.status="in progress",user=p(o,user),DB.users=T(user,DB.users),B(DB),insertTodoStatus("in progress")}function completeTodoHandler(){let e=s("id"),o=t(e,user.todos);o.status="completed",user=p(o,user),DB.users=T(user,DB.users),B(DB),insertTodoStatus("completed")}function updateTodoHandler(t){m(),user=p(t.detail,user),DB.users=T(user,DB.users),B(DB),insertTodoContent(t.detail),c()}deleteTodoBtn.addEventListener("click",deleteTodoHandler),editTodoBtn.addEventListener("click",editTodoHandler),startTodoBtn.addEventListener("click",startTodoHandler),completeTodoBtn.addEventListener("click",completeTodoHandler),document.addEventListener("todoUpdated",updateTodoHandler);