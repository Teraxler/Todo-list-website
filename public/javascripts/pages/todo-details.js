import{findTodo,findTodoIndex,findUser,getCookie,getFromLocalStorage,getQueryParam,normalizeDateTime,saveToLocalStorage}from"../modules/utils.js";import{showEditTodoModal}from"../modules/todo-modal.js";import{hideLoader,showLoader}from"../modules/shared.js";let user={};function insertTodoPriority(e){const t=document.getElementById("todo-priority"),o={high:"text-danger",medium:"text-amber-400",low:"text-picton-blue"};t.classList.remove("text-danger","text-amber-400","text-picton-blue");t.textContent=e;t.classList.add(o[e.toLowerCase()])}function insertTodoStatus(e){const t=document.getElementById("todo-status"),o={"not started":"text-danger","in progress":"text-blue-bonnet",completed:"text-success"};t.classList.remove("text-danger","text-blue-bonnet","text-success");t.textContent=e;t.classList.add(o[e.toLowerCase()])}function insertTodoContent(e){const t=document.getElementById("todo-description"),o=document.getElementById("todo-title"),n=document.getElementById("todo-cover"),i=document.getElementById("todo-created-at");t.textContent=e.description;o.textContent=e.title;n.src=e.cover.img?e.cover.img:`../assets/images/todoes/${e.cover.path}`;insertTodoPriority(e.priority);insertTodoStatus(e.status);i.textContent=normalizeDateTime(e.createdAt).date}async function deleteTodoHandler(){if(await swal({title:"Delete Todo",text:"Are you sure to delete todo?",icon:"warning",buttons:{no:{text:"Cancel",value:!1,className:"swal-btn--natural"},yes:{text:"Delete",value:!0,className:"swal-btn--danger"}}})){const e=getQueryParam("id");user.todos=user.todos.filter((t=>t.id!==e));updateDB(user);location.href="../index.html"}}function editTodoHandler(){const e=getQueryParam("id"),t=findTodo(e,user.todos);showEditTodoModal(t)}function startTodoHandler(){const e=getQueryParam("id"),t=findTodoIndex(e,user.todos);-1!==t&&(user.todos[t].status="In Progress",updateDB(user),insertTodoStatus("In Progress"))}function completeTodoHandler(){const e=getQueryParam("id"),t=findTodoIndex(e,user.todos);-1!==t&&(user.todos[t].status="completed",updateDB(user),insertTodoStatus("completed"))}function updateTodos(e,t){e=[...e];const o=e.findIndex((e=>String(e.id)===String(t.id)));return e[o]=t,e}function updateDB(e){const t=getFromLocalStorage("DB"),o=t.users.findIndex((t=>t.id===e.id));-1!==o&&(t.users[o]=e,saveToLocalStorage("DB",t))}function updateTodoHandler(e){showLoader();const t=e.detail;user.todos=updateTodos(user.todos,t);updateDB(user);insertTodoContent(t);hideLoader()}window.addEventListener("load",async()=>{showLoader();const e=getCookie("userId"),t=getFromLocalStorage("DB");user=findUser(e,t.users);const o=getQueryParam("id");o||(location.href="../index.html");const n=findTodo(o,user.todos);n||(location.href="../index.html");insertTodoContent(n);hideLoader()});const deleteTodoBtn=document.getElementById("delete-todo-btn"),editTodoBtn=document.getElementById("edit-todo-btn"),startTodoBtn=document.getElementById("start-todo-btn"),completeTodoBtn=document.getElementById("complete-todo-btn");deleteTodoBtn.addEventListener("click",deleteTodoHandler);editTodoBtn.addEventListener("click",editTodoHandler);startTodoBtn.addEventListener("click",startTodoHandler);completeTodoBtn.addEventListener("click",completeTodoHandler);document.addEventListener("todoUpdated",updateTodoHandler);