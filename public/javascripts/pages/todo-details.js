import{findTodo,findTodoIndex,findUser,getCookie,getFromLocalStorage,getQueryParam,normalizeDateTime,saveToLocalStorage}from"../modules/utils.js";import{showEditTodoModal}from"../modules/todo-modal.js";import{hideLoader,showLoader}from"../modules/shared.js";let user={};function insertTodoPriority(t){const e=document.getElementById("todo-priority");e.classList.remove("text-danger","text-amber-400","text-picton-blue"),e.textContent=t,e.classList.add({high:"text-danger",medium:"text-amber-400",low:"text-picton-blue"}[t.toLowerCase()])}function insertTodoStatus(t){const e=document.getElementById("todo-status");e.classList.remove("text-danger","text-blue-bonnet","text-success"),e.textContent=t,e.classList.add({"not started":"text-danger","in progress":"text-blue-bonnet",completed:"text-success"}[t.toLowerCase()])}function insertTodoContent(t){const e=document.getElementById("todo-description"),o=document.getElementById("todo-title"),d=document.getElementById("todo-cover"),n=document.getElementById("todo-created-at");e.textContent=t.description,o.textContent=t.title,d.src=t.cover.img?t.cover.img:`../assets/images/todoes/${t.cover.path}`,insertTodoPriority(t.priority),insertTodoStatus(t.status),n.textContent=normalizeDateTime(t.createdAt).date}window.addEventListener("load",(async()=>{showLoader();const t=getCookie("userId"),e=getFromLocalStorage("DB");user=findUser(t,e.users);const o=getQueryParam("id");!o&&(location.href="../index.html");const d=findTodo(o,user.todos);!d&&(location.href="../index.html"),insertTodoContent(d),hideLoader()}));const deleteTodoBtn=document.getElementById("delete-todo-btn"),editTodoBtn=document.getElementById("edit-todo-btn"),startTodoBtn=document.getElementById("start-todo-btn"),completeTodoBtn=document.getElementById("complete-todo-btn");async function deleteTodoHandler(){if(await swal({title:"Delete Todo",text:"Are you sure to delete todo?",icon:"warning",buttons:{no:{text:"Cancel",value:!1,className:"swal-btn--natural"},yes:{text:"Delete",value:!0,className:"swal-btn--danger"}}})){const t=getQueryParam("id");user.todos=user.todos.filter((e=>e.id!==t)),updateDB(user),location.href="../index.html"}}function editTodoHandler(){const t=getQueryParam("id"),e=findTodo(t,user.todos);showEditTodoModal(e)}function startTodoHandler(){const t=getQueryParam("id"),e=findTodoIndex(t,user.todos);-1!==e&&(user.todos[e].status="In Progress",updateDB(user),insertTodoStatus("In Progress"))}function completeTodoHandler(){const t=getQueryParam("id"),e=findTodoIndex(t,user.todos);-1!==e&&(user.todos[e].status="completed",updateDB(user),insertTodoStatus("completed"))}function updateTodos(t,e){const o=(t=[...t]).findIndex((t=>String(t.id)===String(e.id)));return t[o]=e,t}function updateDB(t){const e=getFromLocalStorage("DB"),o=e.users.findIndex((e=>e.id===t.id));-1!==o&&(e.users[o]=t,saveToLocalStorage("DB",e))}function updateTodoHandler(t){showLoader();const e=t.detail;user.todos=updateTodos(user.todos,e),updateDB(user),insertTodoContent(e),hideLoader()}deleteTodoBtn.addEventListener("click",deleteTodoHandler),editTodoBtn.addEventListener("click",editTodoHandler),startTodoBtn.addEventListener("click",startTodoHandler),completeTodoBtn.addEventListener("click",completeTodoHandler),document.addEventListener("todoUpdated",updateTodoHandler);