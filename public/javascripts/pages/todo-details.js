import{findTodo as t,findTodoIndex as e,findUser as o,formattingDateTime as d,getFromLocalStorage as n,getQueryParam as s,normalizeDateTime as r,saveToLocalStorage as i}from"../modules/utils.js";import{showEditTodoModal as l}from"../modules/todo-modal.js";import{hideLoader as a,showLoader as u}from"../modules/shared.js";let user={};function insertTodoPriority(t){let e=document.getElementById("todo-priority");e.classList.remove("text-danger","text-amber-400","text-picton-blue"),e.textContent=t,e.classList.add({high:"text-danger",medium:"text-amber-400",low:"text-picton-blue"}[t.toLowerCase()])}function insertTodoStatus(t){let e=document.getElementById("todo-status");e.classList.remove("text-danger","text-blue-bonnet","text-success"),e.textContent=t,e.classList.add({"not started":"text-danger","in progress":"text-blue-bonnet",finished:"text-success"}[t.toLowerCase()])}function insertTodoContent(t){let e=document.getElementById("todo-description"),o=document.getElementById("todo-title"),d=document.getElementById("todo-cover"),n=document.getElementById("todo-created-at");e.textContent=t.description,o.textContent=t.title,d.src=t.cover.img?t.cover.img:`../assets/images/todoes/${t.cover.path}`,insertTodoPriority(t.priority),insertTodoStatus(t.status),n.textContent=r(t.createdAt).date}window.addEventListener("load",async()=>{u();let e=n("currentUser").userId,d=n("DB");user=o(e,d.users);let r=s("id");r||(location.href="../index.html");let i=t(r,user.todos);i||(location.href="../index.html"),insertTodoContent(i),a()});let deleteTodoBtn=document.getElementById("delete-todo-btn"),editTodoBtn=document.getElementById("edit-todo-btn"),startTodoBtn=document.getElementById("start-todo-btn"),completeTodoBtn=document.getElementById("complete-todo-btn");async function deleteTodoHandler(){let t=await swal({title:"Delete Todo",text:"Are you sure to delete todo?",icon:"warning",buttons:{no:{text:"Cancel",value:!1,className:"swal-btn--natural"},yes:{text:"Delete",value:!0,className:"swal-btn--danger"}}});if(t){let e=s("id");user.todos=user.todos.filter(t=>t.id!==e),updateDB(user),location.href="../index.html"}}function editTodoHandler(){let e=s("id"),o=t(e,user.todos);l(o)}function startTodoHandler(){let t=s("id"),o=e(t,user.todos);-1!==o&&(user.todos[o].status="In Progress",updateDB(user),insertTodoStatus("In Progress"))}function completeTodoHandler(){let t=s("id"),o=e(t,user.todos);-1!==o&&(user.todos[o].status="Finished",updateDB(user),insertTodoStatus("Finished"))}function updateTodos(t,e){t=[...t];let o=t.findIndex(t=>String(t.id)===String(e.id));return t[o]=e,t}function updateDB(t){let e=n("DB"),o=e.users.findIndex(e=>e.id===t.id);-1!==o&&(e.users[o]=t,i("DB",e))}function updateTodoHandler(t){u();let e=t.detail;user.todos=updateTodos(user.todos,e),updateDB(user),insertTodoContent(e),a()}deleteTodoBtn.addEventListener("click",deleteTodoHandler),editTodoBtn.addEventListener("click",editTodoHandler),startTodoBtn.addEventListener("click",startTodoHandler),completeTodoBtn.addEventListener("click",completeTodoHandler),document.addEventListener("todoUpdated",updateTodoHandler);