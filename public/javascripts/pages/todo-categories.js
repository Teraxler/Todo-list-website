import{hideLoader,showOverlay,hideOverlay}from"../modules/shared.js";import{escapeHtml,getFromLocalStorage,saveToLocalStorage}from"../modules/utils.js";let DB={},categories=[];const todoCategoriesContainer=document.getElementById("categories-container");function insertCategories(e,t){let n="";e.length?e.forEach(((t,a)=>{n+=`\n            <div class="flex items-center justify-between">\n              <h4 class="font-semibold">\n                Todo ${t.name}\n                <span class="block h-0.5 w-10 bg-orioles-orange"></span>\n              </h4>\n              <button\n                class="my-auto flex items-center gap-x-2 text-xs text-quick-silver cursor-pointer hover:text-primary transition-all duration-200 hover:*:fill-white hover:*:bg-primary"\n                onclick="showModal('${t.name}')"\n                >\n                <svg\n                  class="fill-primary p-px size-[15px] transition-all duration-200 rounded-full"\n                >\n                  <use href="#plus-icon"></use>\n                </svg>\n                Add New ${t.name}\n              </button>\n            </div>            \n            <div class="overflow-x-auto w-[calc(100%+8px)] -ml-1 px-1 pb-8">\n              ${generateTable(t)}\n            </div>\n            ${e.length!==a+1?'\x3c!-- line --\x3e<div\nclass="w-[calc(100%+56px)] xs:w-[calc(100%+48px)] md:w-[calc(100%+56px)] -ml-6 md:-ml-7 border-t mb-7.5 border-quick-silver/63"></div>':""}`})):n="<span>No Category available</span>",t.innerHTML=n}function generateTable(e){return`\n              <table\n                class="text-sm md:text-base text-center border-separate border-spacing-0 border border-quick-silver/63 rounded-[14px] w-full mt-3.5 shadow-todo"\n              >\n                <thead>\n                  <tr class="border-quick-silver/63">\n                    <th class="px-2.5 py-4 border-b border-quick-silver/63">\n                      SN\n                    </th>\n                    <th\n                      class="text-nowrap w-1/2 xl:w-52/100 px-2.5 py-4 border-b border-x border-quick-silver/63"\n                    >\n                      Todo ${e.name}\n                    </th>\n                    <th\n                      class="px-2.5 w-42/100 xl:w-40/100 py-4 border-b border-quick-silver/63"\n                    >\n                      Action\n                    </th>\n                  </tr>\n                </thead>\n                <tbody\n                  id="todo-status-tbody"\n                  class="*:*:*:mb-3.5 *:*:*:px-2.5 *:first:*:*:mt-4.5 *:last:*:*:mb-4.5"\n                >\n                  ${generateTableRows(e)}\n                </tbody>\n              </table>\n  `}function generateTableRows(e){let t="";return e.values.length?e.values.forEach(((n,a)=>{t+=`<tr>\n            <td>\n              <span class="block">${a+1}</span>\n            </td>\n            <td class="border-x border-quick-silver/63">\n              <span class="capitalize line-clamp-1" title="${n}">${n}</span>\n            </td>\n            <td class="flex justify-center gap-x-3 md:gap-x-4 lg:gap-x-5 xl:gap-x-7.5 px-2.5">\n              <button\n                class="flex items-center gap-x-1 text-white bg-orioles-orange py-1 md:py-1.5 px-3 md:px-3.5 xl:px-4.5 rounded-lg cursor-pointer"\n                  onclick="showModal('${e.name}','${n}')">\n                <svg class="size-4 lg:size-4.75">\n                  <use href="#edit-icon"></use>\n                </svg>\n                Edit\n              </button>\n              <button\n                class="flex items-center gap-x-1 text-white bg-orioles-orange py-1 md:py-1.5 px-3 md:px-3.5 xl:px-4.5 rounded-lg cursor-pointer"\n                  onclick="deleteCategoryValue('${e.name}','${n}')">\n                <svg class="size-4 lg:size-4.75">\n                  <use href="#delete-icon"></use>\n                </svg>\n                Delete\n              </button>\n            </td>\n          </tr>`})):t='<tr>\n                  <td>\n                  </td>\n                  <td class="w-full">\n                    <span class="block text-davy-grey">No category value available</span>\n                  </td>\n                  <td>\n                  </td>\n                </tr>',t}async function deleteCategoryValue(e,t){if(!await swal({title:"Delete category value",text:"are you sure to delete category value?",icon:"warning",buttons:["Cancel","Delete"]}))return;const n=findCategoryIndex(e);categories[n].values=categories[n].values.filter((e=>e!==t)),DB.categories=categories,saveToLocalStorage("DB",DB),insertCategories(categories,todoCategoriesContainer)}function findCategoryIndex(e){return categories.findIndex((t=>t.name===e))}function prepareModal(e,t){const n=document.getElementById("category-modal__title"),a=document.getElementById("category-form__input-label"),o=document.getElementById("category-form__input");n.textContent=`Add Todo ${e}`,a.textContent=`Todo ${e} title`,o.value=t??"",o.dataset.category=e,o.dataset.currentValue=t??""}function showModal(e,t){prepareModal(e,t),showOverlay(),document.getElementById("category-modal").classList.remove("hidden")}function hideModal(){hideOverlay(),document.getElementById("category-modal").classList.add("hidden")}window.deleteCategoryValue=deleteCategoryValue,window.addEventListener("load",(()=>{DB=getFromLocalStorage("DB"),categories=DB.categories,insertCategories(categories,todoCategoriesContainer),hideLoader()})),window.showModal=showModal;const closeModalBtn=document.getElementById("category-modal__close-btn");closeModalBtn.addEventListener("click",hideModal);const overlay=document.getElementById("overlay");function updateCategoryValueHandler(e){e.preventDefault();const t=document.getElementById("category-form__input"),n=t.dataset.category,a=t.dataset.currentValue,o=t.value.trim().toLowerCase(),r=findCategoryIndex(n),l=categories[r].values.findIndex((e=>e===a));o?(-1!==l?categories[r].values[l]=escapeHtml(o):categories[r].values.push(escapeHtml(o)),DB.categories=categories,saveToLocalStorage("DB",DB),insertCategories(categories,todoCategoriesContainer)):swal({title:"Please enter valid value",icon:"warning"}),hideModal()}overlay.addEventListener("click",hideModal);const saveCategoryValueBtn=document.getElementById("category-modal__save-btn");saveCategoryValueBtn.addEventListener("click",updateCategoryValueHandler);