import{hideLoader as e,showOverlay as t,hideOverlay as a,updateDB as o}from"../modules/shared.js";import{escapeHtml as r,getFromLocalStorage as l,saveToLocalStorage as s}from"../modules/utils.js";let DB={},categories=[],todoCategoriesContainer=document.getElementById("categories-container");function generateCategoryHeader(e){return`<div class="flex items-center justify-between"><h4 class="font-semibold">Todo ${e}<span class="block h-0.5 w-10 bg-orioles-orange"></span></h4><button class="my-auto flex items-center gap-x-2 text-xs text-quick-silver cursor-pointer hover:text-primary transition-all duration-200 hover:*:fill-white hover:*:bg-primary" onclick="showModal('${e}')"><svg class="fill-primary p-px size-[15px] transition-all duration-200 rounded-full"><use href="#plus-icon"></use></svg>Add New ${e}</button></div>`}function insertCategories(e,t){let a="";e.length?e.forEach((t,o)=>{a+=`${generateCategoryHeader(t.name)}<div class="overflow-x-auto w-[calc(100%+8px)] -ml-1 px-1 pb-8">${generateTable(t)}</div>${e.length!==o+1?`<!-- line --><div class="w-[calc(100%+56px)] xs:w-[calc(100%+48px)] md:w-[calc(100%+56px)] -ml-6 md:-ml-7 border-t mb-7.5 border-quick-silver/63"></div>`:""}`}):a="<span>No Category available</span>",t.innerHTML=a}function generateTable(e){return`<table class="text-sm md:text-base text-center border-separate border-spacing-0 border border-quick-silver/63 rounded-[14px] w-full mt-3.5 shadow-todo"><thead><tr class="border-quick-silver/63"><th class="px-2.5 py-4 border-b border-quick-silver/63">SN</th><th class="text-nowrap w-1/2 xl:w-52/100 px-2.5 py-4 border-b border-x border-quick-silver/63">Todo ${e.name}</th><th class="px-2.5 w-42/100 xl:w-40/100 py-4 border-b border-quick-silver/63">Action</th></tr></thead><tbody id="todo-status-tbody" class="*:*:*:mb-3.5 *:*:*:px-2.5 *:first:*:*:mt-4.5 *:last:*:*:mb-4.5">${generateTableRows(e)}</tbody></table>`}function generateTableRows(e){let t="";return e.values.length?e.values.forEach((a,o)=>{t+=`<tr><td><span class="block">${o+1}</span></td><td class="border-x border-quick-silver/63"><span class="capitalize line-clamp-1" title="${a}">${a}</span></td><td class="flex justify-center gap-x-3 md:gap-x-4 lg:gap-x-5 xl:gap-x-7.5 px-2.5"><button class="flex items-center gap-x-1 text-white bg-orioles-orange py-1 md:py-1.5 px-3 md:px-3.5 xl:px-4.5 rounded-lg cursor-pointer" onclick="showModal('${e.name}','${a}')"><svg class="size-4 lg:size-4.75"><use href="#edit-icon"></use></svg>Edit</button><button class="flex items-center gap-x-1 text-white bg-orioles-orange py-1 md:py-1.5 px-3 md:px-3.5 xl:px-4.5 rounded-lg cursor-pointer" onclick="deleteCategoryValue('${e.name}','${a}')"><svg class="size-4 lg:size-4.75"><use href="#delete-icon"></use></svg>Delete</button></td></tr>`}):t=`<tr><td></td><td class="w-full"><span class="block text-davy-grey">No category value available</span></td><td></td></tr>`,t}async function deleteCategoryValue(e,t){let a=await swal({title:"Delete category value",text:"are you sure to delete category value?",icon:"warning",buttons:["Cancel","Delete"]});if(!a)return;let r=findCategoryIndex(e);categories[r].values=categories[r].values.filter(e=>e!==t),DB.categories=categories,o(DB),insertCategories(categories,todoCategoriesContainer)}function findCategoryIndex(e){return categories.findIndex(t=>t.name===e)}function initialize(){categories=(DB=l("DB")).categories}function prepareModal(e,t){let a=document.getElementById("category-modal__title"),o=document.getElementById("category-form__input-label"),r=document.getElementById("category-form__input");a.textContent=`Add Todo ${e}`,o.textContent=`Todo ${e} title`,r.value=t??"",r.dataset.category=e,r.dataset.currentValue=t??""}function showModal(e,a){prepareModal(e,a),t(),document.getElementById("category-modal").classList.remove("hidden")}function hideModal(){a(),document.getElementById("category-modal").classList.add("hidden")}window.deleteCategoryValue=deleteCategoryValue,window.addEventListener("load",()=>{initialize(),insertCategories(categories,todoCategoriesContainer),e()}),window.showModal=showModal;let closeModalBtn=document.getElementById("category-modal__close-btn");closeModalBtn.addEventListener("click",hideModal);let overlay=document.getElementById("overlay");function updateCategoryValueHandler(e){e.preventDefault();let t=document.getElementById("category-form__input"),a=t.dataset.category,o=t.dataset.currentValue,l=t.value.trim().toLowerCase(),n=findCategoryIndex(a),i=categories[n].values.findIndex(e=>e===o);l?(-1!==i?categories[n].values[i]=r(l):categories[n].values.push(r(l)),DB.categories=categories,s("DB",DB),insertCategories(categories,todoCategoriesContainer)):swal({title:"Please enter valid value",icon:"warning"}),hideModal()}overlay.addEventListener("click",hideModal);let saveCategoryValueBtn=document.getElementById("category-modal__save-btn");saveCategoryValueBtn.addEventListener("click",updateCategoryValueHandler);